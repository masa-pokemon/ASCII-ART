<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>画像をASCIIアートに変換</title>
  <style>
    body { background: black; color: white; font-family: monospace; }
    #ascii-art { white-space: pre; line-height: 0.6; }
  </style>
</head>
<body>
  <h1>画像をASCIIアートに変換</h1>
  <input type="file" id="imageInput" accept="image/*">
  <pre id="ascii-art"></pre>

  <script>
    const colorset = "MWN$@%#&B89EGA6mK5HRkbYT43V0JL7gpaseyxznocv?jIftr1li*=-~^`':;,. ";
    const asciiWidth = 100; // ASCIIアートの横幅（文字数）

    document.getElementById("imageInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.createElement("canvas");
          const ratio = img.height / img.width;
          canvas.width = asciiWidth;
          canvas.height = asciiWidth * ratio;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          let ascii = "";
          for (let y = 0; y < canvas.height; y++) {
            for (let x = 0; x < canvas.width; x++) {
              const offset = (y * canvas.width + x) * 4;
              const r = data[offset];
              const g = data[offset + 1];
              const b = data[offset + 2];
              const gray = 0.299 * r + 0.587 * g + 0.114 * b;
              const charIndex = Math.floor((gray / 255) * (colorset.length - 1));
              const char = colorset[charIndex];
              ascii += char + char;
            }
            ascii += "\n";
          }
          document.getElementById("ascii-art").textContent = ascii;
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
